<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pack-O-Mat</title>
<style>
body {
    font-family: Arial, sans-serif;
    background: linear-gradient(180deg,#061219,#0b1220);
    color: #fff;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
}
h1 { text-align: center; }
label { display: block; margin-top: 10px; }
input[type=text], input[type=number] { width: 200px; padding:5px; margin-top:3px; }
button { margin-top: 10px; padding: 5px 15px; cursor: pointer; }
ul { list-style: none; padding:0; }
li { margin: 5px 0; }
.container { max-width: 400px; width:100%; margin-top:20px; }
.section { background: rgba(255,255,255,0.05); padding:15px; border-radius:10px; margin-bottom:15px; }
</style>
</head>
<body>

<h1>Pack-O-Mat</h1>

<div class="container">
  <div class="section">
    <h2>Packliste erstellen</h2>
    <label>Artikelname:
      <input type="text" id="itemName" placeholder="z.B. Socken">
    </label>
    <label>Menge:
      <input type="number" id="itemAmount" value="1" min="1">
    </label>
    <button onclick="addItem()">Hinzufügen</button>
  </div>

  <div class="section">
    <h2>Aktuelle Packliste</h2>
    <ul id="packList"></ul>
    <button onclick="generateCode()">Share-Code erstellen</button>
    <p id="shareCodeDisplay" style="word-break: break-all;"></p>
  </div>

  <div class="section">
    <h2>Share-Code eingeben</h2>
    <input type="text" id="codeInput" placeholder="Code hier einfügen">
    <button onclick="loadFromCode()">Packliste anzeigen</button>
  </div>
</div>

<script>
// ======== Dynamische Codierung ========
let ITEM_CODES = {};       // Artikel → Code
let ITEM_BY_CODE = {};     // Code → Artikel
let nextCode = 65;         // ASCII A=65, B=66 ... Z=90, dann weiter aa, ab etc.

function getNextCode() {
  if(nextCode <= 90) return String.fromCharCode(nextCode++);
  else {
    let first = Math.floor((nextCode-91)/26);
    let second = (nextCode-91)%26;
    nextCode++;
    return String.fromCharCode(97+first)+String.fromCharCode(97+second); // aa, ab, ...
  }
}

// ======== Packliste Array ========
let packListArr = [];

// ======== Artikel hinzufügen ========
function addItem() {
  const name = document.getElementById("itemName").value.trim();
  const amount = parseInt(document.getElementById("itemAmount").value);
  if(!name || amount < 1) return alert("Name und Menge korrekt eingeben!");
  
  // neuen Code vergeben falls nötig
  if(!ITEM_CODES[name]) {
    const code = getNextCode();
    ITEM_CODES[name] = code;
    ITEM_BY_CODE[code] = name;
  }

  // prüfen, ob schon vorhanden -> Menge addieren
  let found = packListArr.find(i => i.name === name);
  if(found) found.amount += amount;
  else packListArr.push({name, amount});
  
  renderList();
}

// ======== Liste anzeigen ========
function renderList() {
  const ul = document.getElementById("packList");
  ul.innerHTML = "";
  packListArr.forEach(item => {
    let li = document.createElement("li");
    li.textContent = `${item.amount} × ${item.name}`;
    ul.appendChild(li);
  });
}

// ======== Share-Code generieren ========
function generateCode() {
  if(packListArr.length === 0) return alert("Keine Artikel in der Liste!");
  let encoded = packListArr.map(item=>{
    const code = ITEM_CODES[item.name];
    return code + item.amount;
  }).join("|");
  const base64 = btoa(encoded);
  document.getElementById("shareCodeDisplay").textContent = base64;
}

// ======== Code laden ========
function loadFromCode() {
  const code = document.getElementById("codeInput").value.trim();
  if(!code) return alert("Bitte Code eingeben!");
  let decoded;
  try {
    decoded = atob(code);
  } catch(e) {
    return alert("Ungültiger Code!");
  }
  let parts = decoded.split("|");
  packListArr = parts.map(part => {
    let itemCode = part.match(/^[a-zA-Z]+/)[0];
    let amount = parseInt(part.slice(itemCode.length));
    let name = ITEM_BY_CODE[itemCode];
    if(!name) name = "Unbekannt";
    return {name, amount};
  });
  renderList();
}
</script>

</body>
</html>